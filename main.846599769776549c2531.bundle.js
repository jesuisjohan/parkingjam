/*! For license information please see main.846599769776549c2531.bundle.js.LICENSE.txt */
(()=>{var e,t={57:(e,t,s)=>{"use strict";s(260);const i={ASPECT_RATIO:16/9,SWIPE_MAX_TIME:1e3,SWIPE_MIN_DISTANCE:20,DRAG_DISTANCE_THRESHOLD:50,SWIPE_MIN_NORMAL:.85,TILE_SIZE:200,TILE_SPACING:20,TWEEN_SPEED:50},r={length:3,width:2},o={length:4,width:2},n={length:5,width:2};var a;!function(e){e.PHASER_LOGO="phaser-logo",e.EMPTY_TILE="emptytile",e.BUTTON_CONTINUE="button_pause",e.SHORT_0="minicar_blue",e.SHORT_1="minicar_black",e.SHORT_2="minicar_yellow",e.MEDIUM_0="touringcar_dark",e.MEDIUM_1="touringcar_gray",e.MEDIUM_2="touringcar_white",e.LONG_0="pickup_gray",e.LONG_1="pickup_red",e.LONG_2="pickup_white",e.TRAFFIC_CONE="traffic_cone",e.BOSS="boss"}(a||(a={}));const l=a;var c;!function(e){e[e.NULL=-1]="NULL",e[e.EMPTY=0]="EMPTY",e[e.SHORT_CAR=1]="SHORT_CAR",e[e.MEDIUM_CAR=2]="MEDIUM_CAR",e[e.LONG_CAR=3]="LONG_CAR",e[e.BLOCKER=4]="BLOCKER",e[e.GRANDMA=5]="GRANDMA"}(c||(c={}));const h=c,g=Phaser.Math.Easing.Sine.InOut;class d{constructor(e){this.car=e,this.scene=this.car.scene}playVerticalMovingAnimation(e,t){const{TILE_SIZE:s,TILE_SPACING:r,TWEEN_SPEED:o}=i;this.car.didExit()&&(t+=this.car.getObjectBoardLength());const n=(s+r)*t,a=this.scene.add.tween({targets:this.car,y:`${e?"+":"-"}=${n}`,duration:o*t,ease:g,onComplete:()=>{this.car.didExit()&&this.playFadeAnimation()},onUpdate:()=>{this.car.checkCollideWithBoss()}});this.car.setMoveTween(a)}playHorizontalMovingAnimation(e,t){const{TILE_SIZE:s,TILE_SPACING:r,TWEEN_SPEED:o}=i;this.car.didExit()&&(t+=this.car.getObjectBoardLength());const n=(s+r)*t,a=this.scene.add.tween({targets:this.car,x:`${e?"+":"-"}=${n}`,duration:o*t,ease:g,onComplete:()=>{this.car.didExit()&&this.playFadeAnimation()},onUpdate:()=>{this.car.checkCollideWithBoss()}});this.car.setMoveTween(a)}playFadeAnimation(){this.scene.add.tween({targets:this.car,alpha:0,duration:500,ease:Phaser.Math.Easing.Sine.InOut})}}var u;!function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.UP=2]="UP",e[e.DOWN=3]="DOWN"}(u||(u={}));const T=u;var m;!function(e){e.TRAFFIC_CONE="traffic-cone"}(m||(m={}));const p=m;var f;!function(e){e.SHORT="short-car",e.MEDIUM="medium-car",e.LONG="long-car"}(f||(f={}));const v=f;var E;!function(e){e[e.TILE=0]="TILE",e[e.GAME_OBJECT=1]="GAME_OBJECT"}(E||(E={}));const b=E;class O{constructor(){this.levelIndex=0,this.levelConfigs=[]}static getInstance(){return O.instance||(O.instance=new O),O.instance}addLevel(e){this.levelConfigs.push(e)}getLevel(){return this.levelConfigs[this.levelIndex]}getLevelIndex(){return this.levelIndex}setLevelIndex(e){e>=this.levelConfigs.length||(this.levelIndex=e)}increaseLevelIndex(e=1){this.setLevelIndex(this.levelIndex+e)}getMaxLevelIndex(){return this.levelConfigs.length-1}getLevelConfigsLength(){return this.levelConfigs.length}}function w(e,t){const{TILE_SIZE:s,TILE_SPACING:r}=i;let o=r*(t.column+1)+s*(t.column+.5),n=r*(t.row+1)+s*(t.row+.5);const{boardSize:a}=O.getInstance().getLevel();let l=a.rows*s;return l+=(a.rows+1)*r,n+=(e.game.config.height-l)/2,new Phaser.Geom.Point(o,n)}function I(e,t,s,i=!1){let r=[];if(i)for(let i=e.row;i<e.row+s;i++)for(let s=e.column;s<e.column+t;s++){const e={row:i,column:s};r.push(e)}else for(let i=e.row;i<e.row+t;i++)for(let t=e.column;t<e.column+s;t++){const e={row:i,column:t};r.push(e)}return r}function B(e,t,s){const i=[],{boardSize:r}=O.getInstance().getLevel();switch(s){case T.LEFT:for(let s=e.row;s<e.row+t;s++){const e={row:s,column:0};i.push(e)}break;case T.RIGHT:for(let s=e.row;s<e.row+t;s++){const e={row:s,column:r.columns-1};i.push(e)}break;case T.UP:for(let s=e.column;s<e.column+t;s++){const e={row:0,column:s};i.push(e)}break;case T.DOWN:for(let s=e.column;s<e.column+t;s++){const e={row:r.rows-1,column:s};i.push(e)}}return i}function S(e){let t;switch(e){case v.SHORT:t=h.SHORT_CAR;break;case v.MEDIUM:t=h.MEDIUM_CAR;break;case v.LONG:default:t=h.LONG_CAR}return t}function C(e){let t;switch(e){case v.SHORT:t=r;break;case v.MEDIUM:t=o;break;case v.LONG:default:t=n}return t}function x(e,t){t.cameras.main.fadeOut(500),t.time.addEvent({delay:500,callback:function(){t.cameras.main.fadeIn(500),e()},callbackScope:t})}class L{constructor(e,t=!0){const{boardSize:s}=O.getInstance().getLevel();this.boardArray=[],this.exitTiles=[],this.tileImages=[];for(let i=0;i<s.rows;i++){this.boardArray[i]=[],this.exitTiles[i]=[];for(let r=0;r<s.columns;r++){if(t){const t=w(e,{row:i,column:r});this.tileImages.push(e.add.image(t.x,t.y,l.EMPTY_TILE).setDepth(b.TILE))}this.boardArray[i][r]=h.EMPTY,this.exitTiles[i][r]=!1}}}setTileState(e,t){this.getTileState(e)!=h.NULL&&(this.boardArray[e.row][e.column]=t)}getTileState(e){const{boardSize:t}=O.getInstance().getLevel();return e.row>=0&&e.row<t.rows&&e.column>=0&&e.column<t.columns?this.boardArray[e.row][e.column]:h.NULL}isExit(e){return this.exitTiles[e.row][e.column]}setExit(e){this.exitTiles[e.row][e.column]=!0}printBoard(){console.log(this.boardArray)}clearAllTiles(){this.tileImages.forEach((e=>null==e?void 0:e.destroy())),this.boardArray=[],this.exitTiles=[]}getTileImages(){return this.tileImages}longestEmptySubarrayOnTiles(e){const t=[],s=[];let i=!1;for(let r=0;r<e.length;r++)this.getTileState(e[r])==h.EMPTY?i||(t.push(r),i=!0):i&&(s.push(r-1),i=!1);t.length!=s.length&&s.push(e.length-1);let r=0,o=0;for(let e=0;e<t.length;e++)s[e]-t[e]>=1&&(r=t[e],o=s[e]);return e.slice(r,o+1)}longestEmptyTileSubarrayOnTopSide(){const{boardSize:e}=O.getInstance().getLevel(),t=[];for(let s=0;s<e.columns;s++)t.push({row:0,column:s});return this.longestEmptySubarrayOnTiles(t)}longestEmptyTileSubarrayOnBottomSide(){const{boardSize:e}=O.getInstance().getLevel(),t=[];for(let s=0;s<e.columns;s++)t.push({row:e.rows-1,column:s});return this.longestEmptySubarrayOnTiles(t)}longestEmptyTileSubarrayOnLeftSide(){const{boardSize:e}=O.getInstance().getLevel(),t=[];for(let s=0;s<e.rows;s++)t.push({row:s,column:0});return this.longestEmptySubarrayOnTiles(t)}longestEmptyTileSubarrayOnRightSide(){const{boardSize:e}=O.getInstance().getLevel(),t=[];for(let s=0;s<e.rows;s++)t.push({row:s,column:e.columns-1});return this.longestEmptySubarrayOnTiles(t)}}class M{constructor(e){this.scene=e,this.carConfigs=[],this.blockerConfigs=[],this.generateLevel(M.placeCarOnBorder)}getCarConfigs(){return this.carConfigs}getBlockerConfig(){return this.blockerConfigs}populateCars(e){const{boardSize:t}=O.getInstance().getLevel(),s=[v.SHORT,v.MEDIUM,v.LONG];for(let i=e?0:1;i<t.rows-(e?0:1);i++)for(let r=e?0:1;r<t.columns-(e?0:1);r++){const t={type:s[Phaser.Math.Between(0,s.length-1)],boardPosition:{row:i,column:r},isVertical:1==Phaser.Math.Between(0,1)},o=this.generatePredictableOverlapTiles(t),n=!0;this.canPlaceCarOnTiles(o,e)&&n&&(this.carConfigs.push(t),o.forEach((e=>{this.boardManager.setTileState(e,S(t.type))})),this.markCarExitTiles(t))}}canPlaceCarOnTiles(e,t){const{boardSize:s}=O.getInstance().getLevel();for(const i of e){const e=(t?0:1)<=i.row&&i.row<s.rows-(t?0:1),r=(t?0:1)<=i.column&&i.column<s.columns-(t?0:1),o=e&&r;if(this.boardManager.getTileState(i)!=h.EMPTY||!o)return!1}return!0}markCarExitTiles(e){let t=[],s=[];e.isVertical?(t=B(e.boardPosition,C(e.type).width,T.UP),s=B(e.boardPosition,C(e.type).width,T.DOWN)):(t=B(e.boardPosition,C(e.type).width,T.LEFT),s=B(e.boardPosition,C(e.type).width,T.RIGHT)),t.forEach((e=>{this.boardManager.setExit(e)})),s.forEach((e=>{this.boardManager.setExit(e)}))}populateBlockers(){const e=[p.TRAFFIC_CONE];Phaser.Math.Between(0,e.length-1),p.TRAFFIC_CONE,this.populateTrafficCones()}populateTrafficCones(){this.populateTopEdgeTrafficCone(),this.populateBottomEdgeTrafficCone()}populateTopEdgeTrafficCone(){const{boardSize:e}=O.getInstance().getLevel();for(let t=0;t<e.rows;t++){const s={row:t,column:0},i={row:t,column:e.columns-1};if(!this.boardManager.isExit(s)){const e={type:p.TRAFFIC_CONE,boardPosition:s};1==Phaser.Math.Between(0,1)&&this.blockerConfigs.push(e)}if(!this.boardManager.isExit(i)){const e={type:p.TRAFFIC_CONE,boardPosition:i};1==Phaser.Math.Between(0,1)&&this.blockerConfigs.push(e)}}}populateBottomEdgeTrafficCone(){const{boardSize:e}=O.getInstance().getLevel();for(let t=1;t<e.columns-1;t++){const s={row:0,column:t},i={row:e.rows-1,column:t};if(!this.boardManager.isExit(s)){const e={type:p.TRAFFIC_CONE,boardPosition:s};1==Phaser.Math.Between(0,1)&&this.blockerConfigs.push(e)}if(!this.boardManager.isExit(i)){const e={type:p.TRAFFIC_CONE,boardPosition:i};1==Phaser.Math.Between(0,1)&&this.blockerConfigs.push(e)}}}generatePredictableOverlapTiles(e){const t=C(e.type);return I(e.boardPosition,t.width,t.length,e.isVertical)}generateLevel(e=!1){this.carConfigs=[],this.blockerConfigs=[],this.boardManager=new L(this.scene,!1),this.populateCars(e),e||this.populateBlockers()}}M.placeCarOnBorder=!0;class P{constructor(){this.blockers=[],this.blockersAtExit=[]}static getInstance(){return P.instance||(P.instance=new P),P.instance}push(e,t=!1){this.blockers.push(e),t&&this.blockersAtExit.push(e)}toArray(){return this.blockers}clearAllBlocker(){this.blockers.forEach((e=>null==e?void 0:e.destroy())),this.blockers=[],this.blockersAtExit=[]}deleteBlocker(e){const t=this.blockers.indexOf(e);-1!==t&&this.blockers.splice(t,1),this.blockersAtExit.indexOf(e),-1!==t&&this.blockersAtExit.splice(t,1)}getBlockersAtExit(){return this.blockersAtExit}}class k extends Phaser.GameObjects.Image{constructor(e,t,s){const i=w(e,t);super(e,i.x,i.y,s),this.setOrigin(.5,.5),this.setDepth(b.GAME_OBJECT),this.boardPosition=t,this.setOverlapTileStates(h.BLOCKER),e.add.existing(this)}setOverlapTileStates(e){const t=this.scene;null==t||t.getBoardManager().setTileState(this.boardPosition,e)}getBoardPosition(){return this.boardPosition}}class _ extends k{constructor(e,t,s=l.TRAFFIC_CONE){super(e,t,s)}}class A{constructor(e,t,s,i){this.removeBlockingCorns=e=>{this.mainScene.getBoardManager().getTileState(e)==h.BLOCKER&&P.getInstance().getBlockersAtExit().forEach((t=>{t.getBoardPosition().row==e.row&&t.getBoardPosition().column==e.column&&(t.setOverlapTileStates(h.EMPTY),console.log("destroy "+t.getBoardPosition().row+" "+t.getBoardPosition().column),P.getInstance().deleteBlocker(t),t.destroy())}))},this.mainScene=e,this.firstTiles=t,this.secondTiles=s,this.placeCarOnBorder=i,t.forEach((e=>{this.mainScene.getBoardManager().setExit(e)})),s.forEach((e=>{this.mainScene.getBoardManager().setExit(e)}))}getScene(){return this.mainScene}getFirstTiles(){return this.firstTiles}getSecondTiles(){return this.secondTiles}blockFirstTiles(){this.placeCarOnBorder||this.areFirstTilesBlocked()||this.areSecondTilesBlocked()||this.firstTiles.forEach((e=>{const t=new _(this.mainScene,e);P.getInstance().push(t,!0)}))}blockSecondTiles(){this.placeCarOnBorder||this.areFirstTilesBlocked()||this.areSecondTilesBlocked()||this.secondTiles.forEach((e=>{const t=new _(this.mainScene,e);P.getInstance().push(t,!0)}))}removeBlockerInFirstTiles(){this.firstTiles.forEach(this.removeBlockingCorns)}removeBlockerInSecondTiles(){this.secondTiles.forEach(this.removeBlockingCorns)}areFirstTilesBlocked(){for(const e of this.firstTiles)if(this.mainScene.getBoardManager().getTileState(e)===h.BLOCKER)return!0;return!1}areSecondTilesBlocked(){for(const e of this.secondTiles)if(this.mainScene.getBoardManager().getTileState(e)===h.BLOCKER)return!0;return!1}areAllTilesGroupsBlocked(){return this.areFirstTilesBlocked()&&this.areSecondTilesBlocked()}}class N{constructor(){this.cars=[],this.exitedCarNum=0}static getInstance(){return N.instance||(N.instance=new N),N.instance}push(e){this.cars.push(e)}didAllCarExit(){return this.exitedCarNum==this.cars.length&&this.cars.length>0}toArray(){return this.cars}clearAllCars(){this.cars.forEach((e=>null==e?void 0:e.destroy())),this.cars=[],this.exitedCarNum=0}increaseExitedCarNum(){this.exitedCarNum++}}const y=h.SHORT_CAR,R=[h.SHORT_CAR,h.MEDIUM_CAR,h.LONG_CAR,h.BLOCKER];class D extends Phaser.GameObjects.Image{constructor(e,t,s=!1,i){super(e,0,0,i),this.exited=!1,this.setOrigin(.5,.5),this.setDepth(b.GAME_OBJECT),e.add.existing(this),this.initRotation(s),this.initBoardPosition(t),this.setOverlapTilesState(this.getTileState())}getBoardPosition(){return this.boardPosition}getTileState(){return y}getObjectBoardLength(){return 3}getObjectBoardWidth(){return 2}getIsVertical(){return this.isVertical}didExit(){return this.exited}initBoardPosition(e){this.boardPosition=e,this.initActualPosition()}initActualPosition(){const e=this.calculateActualPosition();this.setPosition(e.x,e.y)}calculateActualPosition(){return function(e,t,s,i,r=!1){const o=r?(i-1)/2:s/4,n=r?s/4:(i-1)/2;return w(e,{row:t.row+o,column:t.column+n})}(this.scene,this.boardPosition,this.getObjectBoardWidth(),this.getObjectBoardLength(),this.isVertical)}initRotation(e){this.isVertical=e,this.angle=e?90:0}canTileBlockObject(e){return R.includes(e)}moveVertically(e){const t=e?this.computeTravelingBoardDistanceDown():this.computeTravelingBoardDistanceUp();this.resetOverlapTilesVertical(e,t)}computeTravelingBoardDistanceDown(){if(this.exited)return 0;if(!this.isVertical)return 0;const e=this.scene,t=this.getFrontTiles(),s=t[0].row;let i=s;for(;;){i++;let s=!1,r=!1;for(const o of t){const t={row:i,column:o.column},n=e.getBoardManager().getTileState(t);if(this.canTileBlockObject(n)){s=!0,r=!1;break}r=n===h.NULL}if(s)break;if(r){this.executeExit();break}}return i-1-s}computeTravelingBoardDistanceUp(){if(this.exited)return 0;if(!this.isVertical)return 0;const e=this.scene,t=this.getRearTiles(),s=t[0].row;let i=s;for(;;){i--;let s=!1,r=!1;for(const o of t){const t={row:i,column:o.column},n=e.getBoardManager().getTileState(t);if(this.canTileBlockObject(n)){s=!0,r=!1;break}r=n===h.NULL}if(s)break;if(r){this.executeExit();break}}return s-(i+1)}resetOverlapTilesVertical(e,t){this.setOverlapTilesState(h.EMPTY),this.exited||(e?this.boardPosition.row+=t:this.boardPosition.row-=t,this.setOverlapTilesState(this.getTileState()))}setOverlapTilesState(e){const t=this.scene;this.getOverlapTiles().forEach((s=>{t.getBoardManager().getTileState(s)!=h.NULL?t.getBoardManager().setTileState(s,e):console.log(`${s.row} ${s.column} is null`)}))}moveHorizontally(e){const t=e?this.computeTravelingBoardDistanceRight():this.computeTravelingBoardDistanceLeft();this.resetOverlapTilesHorizontal(e,t)}computeTravelingBoardDistanceRight(){if(this.exited)return 0;if(this.isVertical)return 0;const e=this.scene,t=this.getFrontTiles(),s=t[0].column;let i=s;for(;;){i++;let s=!1,r=!1;for(const o of t){const t={row:o.row,column:i},n=e.getBoardManager().getTileState(t);if(this.canTileBlockObject(n)){s=!0,r=!1;break}r=n===h.NULL}if(s)break;if(r){this.executeExit();break}}return i-1-s}computeTravelingBoardDistanceLeft(){if(this.exited)return 0;if(this.isVertical)return 0;const e=this.scene,t=this.getRearTiles(),s=t[0].column;let i=s;for(;;){i--;let s=!1,r=!1;for(const o of t){const t={row:o.row,column:i},n=e.getBoardManager().getTileState(t);if(this.canTileBlockObject(n)){s=!0,r=!1;break}r=n===h.NULL}if(s)break;if(r){this.executeExit();break}}return s-(i+1)}resetOverlapTilesHorizontal(e,t){this.setOverlapTilesState(h.EMPTY),this.exited||(e?this.boardPosition.column+=t:this.boardPosition.column-=t,this.setOverlapTilesState(this.getTileState()))}getRearTiles(){const e=[];if(this.exited)return e;if(this.isVertical)for(let t=this.boardPosition.column;t<this.boardPosition.column+this.getObjectBoardWidth();t++){const s={row:this.boardPosition.row,column:t};e.push(s)}else for(let t=this.boardPosition.row;t<this.boardPosition.row+this.getObjectBoardWidth();t++){const s={row:t,column:this.boardPosition.column};e.push(s)}return e}getFrontTiles(){const e=[];if(this.exited)return e;if(this.isVertical)for(let t=this.boardPosition.column;t<this.boardPosition.column+this.getObjectBoardWidth();t++){const s={row:this.boardPosition.row+this.getObjectBoardLength()-1,column:t};e.push(s)}else for(let t=this.boardPosition.row;t<this.boardPosition.row+this.getObjectBoardWidth();t++){const s={row:t,column:this.boardPosition.column+this.getObjectBoardLength()-1};e.push(s)}return e}getOverlapTiles(){return I(this.boardPosition,this.getObjectBoardWidth(),this.getObjectBoardLength(),this.isVertical)}executeExit(){this.exited=!0}}const F=r,{width:j,length:G}=F,H=h.SHORT_CAR;class U extends D{constructor(e,t,s=!1,r){super(e,t,s,r),this.handleDragging=(e,t,s)=>{if(!this.moveTween)if(this.isVertical){const e=s-this.y;if(Math.abs(e)>i.SWIPE_MIN_DISTANCE){const t=e>=0;this.moveVertically(t)}}else{const e=t-this.x;if(Math.abs(e)>i.SWIPE_MIN_DISTANCE){const t=e>=0;this.moveHorizontally(t)}}},this.initAnimator(),this.initExitTiles(),this.initInteractive(),this.randomRenderFlip()}getTileState(){return H}getObjectBoardLength(){return G}getObjectBoardWidth(){return j}getExitManager(){return this.exitManager}setMoveTween(e){this.moveTween=e}initAnimator(){this.animator=new d(this)}randomRenderFlip(){Math.random()<.5&&this.setFlipX(!0),Math.random()<.5&&this.setFlipY(!0)}initExitTiles(){const e=this.scene;let t=[],s=[];this.isVertical?(t=B(this.boardPosition,this.getObjectBoardWidth(),T.UP),s=B(this.boardPosition,this.getObjectBoardWidth(),T.DOWN)):(t=B(this.boardPosition,this.getObjectBoardWidth(),T.LEFT),s=B(this.boardPosition,this.getObjectBoardWidth(),T.RIGHT)),this.exitManager=new A(e,t,s,M.placeCarOnBorder)}initInteractive(){this.setInteractive({useHandCursor:!0}),this.scene.input.setDraggable(this),this.on(Phaser.Input.Events.DRAG,this.handleDragging),this.on(Phaser.Input.Events.DRAG_END,(()=>{this.moveTween=void 0}))}moveVertically(e){const t=e?this.computeTravelingBoardDistanceDown():this.computeTravelingBoardDistanceUp();this.exited&&this.removeInteractive(),this.resetOverlapTilesVertical(e,t),this.animator.playVerticalMovingAnimation(e,t)}moveHorizontally(e){const t=e?this.computeTravelingBoardDistanceRight():this.computeTravelingBoardDistanceLeft();this.exited&&this.removeInteractive(),this.resetOverlapTilesHorizontal(e,t),this.animator.playHorizontalMovingAnimation(e,t)}executeExit(){super.executeExit(),N.getInstance().increaseExitedCarNum()}checkCollideWithBoss(){const e=this.scene,t=e.getBosses();for(const s of t)if(Phaser.Geom.Intersects.RectangleToRectangle(this.getBounds(),s.getBounds()))return void e.playLoseConfetti()}}class W extends U{constructor(e,t,s=!1,i){let r;switch(Phaser.Math.Between(0,2)){case 0:r=l.SHORT_0;break;case 1:r=l.SHORT_1;break;default:r=l.SHORT_2}super(e,t,s,null==i?r:i)}getObjectBoardWidth(){return r.width}getObjectBoardLength(){return r.length}getTileState(){return h.SHORT_CAR}}class V extends U{constructor(e,t,s=!1,i){let r;switch(Phaser.Math.Between(0,2)){case 0:r=l.LONG_0;break;case 1:r=l.LONG_1;break;default:r=l.LONG_2}super(e,t,s,null==i?r:i)}getObjectBoardWidth(){return n.width}getObjectBoardLength(){return n.length}getTileState(){return h.LONG_CAR}}class z extends U{constructor(e,t,s=!1,i){let r;switch(Phaser.Math.Between(0,2)){case 0:r=l.MEDIUM_0;break;case 1:r=l.MEDIUM_1;break;default:r=l.MEDIUM_2}super(e,t,s,null==i?r:i)}getObjectBoardWidth(){return o.width}getObjectBoardLength(){return o.length}getTileState(){return h.MEDIUM_CAR}}var Y;!function(e){e.PRELOAD="PreloadScene",e.MAIN="MainScene"}(Y||(Y={}));const $=Y;class Z{constructor(e,t=!1){this.cars=e,t&&this.blockExits}blockExits(){this.cars.forEach((e=>{1==Phaser.Math.Between(0,1)&&(0===Phaser.Math.Between(0,1)?e.getExitManager().blockFirstTiles():e.getExitManager().blockSecondTiles())})),this.cars.forEach((e=>{e.getExitManager().areAllTilesGroupsBlocked()&&e.getExitManager().removeBlockerInFirstTiles()})),this.debugBlockedCars(65280),this.solveTwoBlockedCars()}debugBlockedCars(e){this.cars.forEach((t=>{t.getExitManager().areAllTilesGroupsBlocked()&&t.setTintFill(e)}))}solveTwoBlockedCars(){for(let e=0;e<this.cars.length;e++)if(this.cars[e].getIsVertical()){if(this.cars[e].getExitManager().areFirstTilesBlocked())for(let t=e+1;t<this.cars.length;t++)1==Math.abs(this.cars[t].getBoardPosition().column-this.cars[e].getBoardPosition().column)&&this.cars[t].getExitManager().areSecondTilesBlocked()&&this.cars[t].getIsVertical()&&this.cars[e].getExitManager().removeBlockerInFirstTiles()}else if(this.cars[e].getExitManager().areFirstTilesBlocked())for(let t=e+1;t<this.cars.length;t++)1==Math.abs(this.cars[t].getBoardPosition().row-this.cars[e].getBoardPosition().row)&&this.cars[t].getExitManager().areSecondTilesBlocked()&&!this.cars[t].getIsVertical()&&this.cars[t].getBoardPosition().column>this.cars[e].getBoardPosition().column&&this.cars[e].getExitManager().removeBlockerInFirstTiles();else if(this.cars[e].getExitManager().areSecondTilesBlocked())for(let t=e+1;t<this.cars.length;t++)1==Math.abs(this.cars[t].getBoardPosition().row-this.cars[e].getBoardPosition().row)&&this.cars[t].getExitManager().areFirstTilesBlocked()&&!this.cars[t].getIsVertical()&&this.cars[t].getBoardPosition().column<this.cars[e].getBoardPosition().column&&this.cars[e].getExitManager().removeBlockerInSecondTiles()}}class J extends Phaser.GameObjects.Image{constructor(e,t,s,i,r,o){super(r,e,t,s,0),this.setInteractive({useHandCursor:!0}),this.setScrollFactor(0),this.on(Phaser.Input.Events.POINTER_UP,(()=>{o||this.setFrame(1)}),this),this.on(Phaser.Input.Events.POINTER_DOWN,(()=>{o||this.setFrame(2),i.call(r)}),this),this.on(Phaser.Input.Events.POINTER_OVER,(()=>{o||this.setFrame(1)}),this),this.on(Phaser.Input.Events.POINTER_OUT,(()=>{o||this.setFrame(0)}),this),r.add.existing(this)}}class K extends J{constructor(e,t,s,i){super(t,s,i,(()=>{O.getInstance().increaseLevelIndex(),e.scene.restart()}),e,!1),this.setOrigin(0,0)}}class X extends J{constructor(e,t,s,i,r){super(t,s,i,(()=>{r.printBoard()}),e,!1),this.setOrigin(0,0)}}const q=Phaser.Math.Easing.Sine.InOut;class Q{constructor(e){this.boss=e,this.scene=this.boss.scene}playVerticalMovingAnimation(e,t){const{TILE_SIZE:s,TILE_SPACING:r,TWEEN_SPEED:o}=i,n=(s+r)*t,a=this.scene.add.tween({targets:this.boss,y:`${e?"+":"-"}=${n}`,duration:o*t,ease:q});this.boss.setMoveTween(a)}playHorizontalMovingAnimation(e,t){const{TILE_SIZE:s,TILE_SPACING:r,TWEEN_SPEED:o}=i,n=(s+r)*t;this.scene.add.tween({targets:this.boss,x:`${e?"+":"-"}=${n}`,duration:o*t,ease:q})}}const ee=h.GRANDMA,{width:te,length:se}={width:1,length:1},ie=[h.SHORT_CAR,h.MEDIUM_CAR,h.LONG_CAR];class re extends D{constructor(e,t,s=!1,i,r,o){super(e,t,s,o),this.initAnimator(),this.initRoute(r),this.initDirection(i),this.moveEachDelay(500)}getTileState(){return ee}getObjectBoardLength(){return se}getObjectBoardWidth(){return te}calculateActualPosition(){return w(this.scene,this.boardPosition)}initAnimator(){this.animator=new Q(this)}initRoute(e){this.route=e}initDirection(e){this.direction=e}setMoveTween(e){this.moveTween=e}flipRenderHorizontally(){this.setFlipX(!this.flipX)}flipRenderVertically(){this.setFlipY(!this.flipY)}moveEachDelay(e){this.scene.time.addEvent({delay:e,callback:()=>{this.moveOnRoute()},callbackScope:this,loop:!0})}moveVertically(e){this.resetOverlapTilesVertical(e,1),this.animator.playVerticalMovingAnimation(e,1)}moveHorizontally(e){this.resetOverlapTilesHorizontal(e,1),this.animator.playHorizontalMovingAnimation(e,1)}doesTileHaveCar(e){const t=this.scene.getBoardManager().getTileState(e);return ie.includes(t)}doesNodeNextMoveHaveCar(){if(!this.route)return!1;const e=this.route.getNodeNextMove();return e&&this.doesTileHaveCar(e.tile)}moveOnRoute(){if(this.route)if(this.doesNodeNextMoveHaveCar())console.log("Car block boss");else if(this.route.traverse())switch(this.route.directionJustTraverse()){case T.UP:this.moveVertically(!1),this.setAngle(-90);break;case T.DOWN:this.moveVertically(!0),this.setAngle(90);break;case T.LEFT:this.moveHorizontally(!1),this.setAngle(-180);break;case T.RIGHT:this.moveHorizontally(!0),this.setAngle(0)}}}class oe{constructor(e){this.tile=e,this.previous=null,this.next=null}computeManhattanDistanceFromNode(e){return null===e?0:Math.abs(this.tile.row-e.tile.row)+Math.abs(this.tile.column-e.tile.column)}directionFromNode(e){return null===e?null:e.tile.row-this.tile.row==1&&this.tile.column==e.tile.column?T.UP:this.tile.row-e.tile.row==1&&this.tile.column==e.tile.column?T.DOWN:e.tile.column-this.tile.column==1&&this.tile.row==e.tile.row?T.LEFT:this.tile.column-e.tile.column==1&&this.tile.row==e.tile.row?T.RIGHT:null}directionFromPrevious(){return this.directionFromNode(this.previous)}directionFromNext(){return this.directionFromNode(this.next)}clone(){return new oe(Object.assign({},this.tile))}}class ne{constructor(){this.head=null,this.tail=null,this.current=null,this.length=0,this.isTraversingForward=!0}isTileValid(e){const{rows:t,columns:s}=O.getInstance().getLevel().boardSize,i=e.row>=0&&e.row<t,r=e.column>=0&&e.column<s;return i&&r}push(e){if(!this.isTileValid(e))return this;const t=new oe(e);if(null===this.head)this.head=t,this.tail=t,this.current=t,this.headTile=e;else{if(1!=t.computeManhattanDistanceFromNode(this.tail))return this;this.tail.next=t,t.previous=this.tail,this.tail=t}return this.length++,this}traverseForward(){return!(!this.isTraversingForward||!this.current||!this.current.next||(this.current=this.current.next,0))}traverseBackward(){return!(this.isTraversingForward||!this.current||!this.current.previous||(this.current=this.current.previous,0))}changeDirection(){this.isTraversingForward=!this.isTraversingForward}traverse(){if(!this.current)return console.log("current is null"),!1;if(this.isTraversingForward){if(this.traverseForward())return!0;if(this.current.previous)return this.changeDirection(),this.traverseBackward(),!0}else{if(this.traverseBackward())return!0;if(this.current.next)return this.changeDirection(),this.traverseForward(),!0}return console.log("return false"),!1}directionJustTraverse(){return this.current?this.isTraversingForward?this.current.directionFromPrevious():this.current.directionFromNext():null}getNodeNextMove(){return this.current?this.isTraversingForward?this.current.next:this.current.previous:null}}class ae extends J{constructor(e,t,s,i){super(t,s,i,(()=>{O.getInstance().increaseLevelIndex(-1),e.scene.restart()}),e,!1),this.setOrigin(0,0),this.setFlipX(!0)}}class le extends Phaser.Scene{constructor(){super($.MAIN),this.carConfigs=[],this.blockerConfigs=[],this.showedWinPopup=!1,this.showedLosePopup=!1}init(){var e;this.carConfigs=[],this.blockerConfigs=[],this.showedWinPopup=!1,this.showedLosePopup=!1,null===(e=this.boardManager)||void 0===e||e.clearAllTiles(),N.getInstance().clearAllCars(),P.getInstance().clearAllBlocker(),this.bosses=[]}create(){this.input.dragDistanceThreshold=i.DRAG_DISTANCE_THRESHOLD,this.initCamera(),this.initBoard(),this.initLevelGenerator(),this.initCars(),this.initBlockers(),this.initButtonNextLevel(),this.initButtonPreviousLevel(),this.initLevelText(),this.initBoss()}initCamera(){const{boardSize:e}=O.getInstance().getLevel(),{TILE_SIZE:t,TILE_SPACING:s}=i,r=t+s;let o=e.columns*r;o+=s,this.cameras.main.setZoom(this.game.config.width/o/1.3).centerOnX(o/2),this.UICamera=this.cameras.add()}initBoard(){this.boardManager=new L(this),this.UICamera.ignore(this.boardManager.getTileImages())}initLevelGenerator(){const e=O.getInstance();M.placeCarOnBorder=e.getLevelIndex()!=e.getLevelConfigsLength()-1,this.levelGenerator=new M(this)}initCars(){const e=O.getInstance();e.getLevelIndex()===e.getLevelConfigsLength()-1?this.carConfigs=this.levelGenerator.getCarConfigs():this.carConfigs=e.getLevel().cars,this.carConfigs.forEach((e=>{N.getInstance().push(this.generateCar(e))})),this.UICamera.ignore(N.getInstance().toArray())}initBlockers(){const e=O.getInstance();e.getLevelIndex()===e.getLevelConfigsLength()-1?this.blockerConfigs=this.levelGenerator.getBlockerConfig():this.blockerConfigs=e.getLevel().blockers,this.blockerConfigs.forEach((e=>{P.getInstance().push(this.generateBlocker(e))})),this.initExitBlockerSpawner(),this.UICamera.ignore(P.getInstance().toArray())}initBoss(){this.bosses=[];const e=new ne,t=new ne,{longest:s,secondLongest:i}=this.getLongestAndSecondLongestEmptySubArrays();if(s.length>2){s.forEach((t=>e.push(t)));const t=new re(this,Object.assign({},e.head.tile),!1,T.RIGHT,e,l.BOSS);this.bosses.push(t)}if(i.length>2){i.forEach((e=>t.push(e)));const e=new re(this,Object.assign({},t.head.tile),!1,T.DOWN,t,l.BOSS);this.bosses.push(e)}this.UICamera.ignore(this.bosses)}getLongestAndSecondLongestEmptySubArrays(){const e=[];return e.push(this.boardManager.longestEmptyTileSubarrayOnTopSide()),e.push(this.boardManager.longestEmptyTileSubarrayOnBottomSide()),e.push(this.boardManager.longestEmptyTileSubarrayOnLeftSide()),e.push(this.boardManager.longestEmptyTileSubarrayOnRightSide()),e.sort(((e,t)=>e.length-t.length)),e.reverse(),{longest:e[0],secondLongest:e[1]}}initExitBlockerSpawner(){this.exitBlockerSpawner=new Z(N.getInstance().toArray()),this.exitBlockerSpawner.blockExits()}initButtonNextLevel(){const e=new K(this,120,20,l.BUTTON_CONTINUE).setScale(.5);e.setDepth(10),this.cameras.main.ignore(e)}initButtonPreviousLevel(){const e=new ae(this,20,20,l.BUTTON_CONTINUE).setScale(.5);e.setDepth(10),this.cameras.main.ignore(e)}initLevelText(){this.levelText=this.add.text(this.game.config.width-20,20,"0",{font:"100px JetBrains Mono",color:"#ffde00",stroke:"#000",strokeThickness:10}).setScale(.5).setOrigin(1,0),this.levelText.setDepth(10),this.cameras.main.ignore(this.levelText)}initButtonPrintBoard(){const e=new X(this,this.game.config.width-100,100,l.BUTTON_CONTINUE,this.boardManager).setScale(.5);e.setDepth(10),this.cameras.main.ignore(e)}generateCar(e){let t;switch(e.type){case v.SHORT:t=new W(this,e.boardPosition,e.isVertical,e.texture);break;case v.MEDIUM:t=new z(this,e.boardPosition,e.isVertical,e.texture);break;case v.LONG:default:t=new V(this,e.boardPosition,e.isVertical,e.texture)}return t}generateBlocker(e){let t;return e.type,p.TRAFFIC_CONE,t=new _(this,e.boardPosition,e.texture),t}getBoardManager(){return this.boardManager}getBosses(){return this.bosses}checkWin(){const e=O.getInstance();N.getInstance().didAllCarExit()&&!this.showedWinPopup&&(console.log("WIN"),this.showedWinPopup=!0,x((()=>{e.increaseLevelIndex(),this.scene.restart()}),this))}playLoseConfetti(){this.showedLosePopup||(console.log("LOSE"),this.showedLosePopup=!0,x((()=>{this.scene.restart()}),this))}updateLevelText(){const e=O.getInstance();e.getLevelIndex().toString()!=this.levelText.text&&(this.levelText.text=e.getLevelIndex().toString())}update(e,t){this.checkWin(),this.updateLevelText()}}class ce extends Phaser.Scene{constructor(){super($.PRELOAD)}preload(){this.load.image(l.PHASER_LOGO,"assets/img/phaser-logo.png"),this.load.image(l.EMPTY_TILE,"assets/img/emptytile.png"),this.load.image(l.SHORT_0,"assets/img/cars/minicar_blue.png"),this.load.image(l.SHORT_1,"assets/img/cars/minicar_black.png"),this.load.image(l.SHORT_2,"assets/img/cars/minicar_yellow.png"),this.load.image(l.MEDIUM_0,"assets/img/cars/touringcar_dark.png"),this.load.image(l.MEDIUM_1,"assets/img/cars/touringcar_gray.png"),this.load.image(l.MEDIUM_2,"assets/img/cars/touringcar_white.png"),this.load.image(l.LONG_0,"assets/img/cars/pickup_gray.png"),this.load.image(l.LONG_1,"assets/img/cars/pickup_red.png"),this.load.image(l.LONG_2,"assets/img/cars/pickup_white.png"),this.load.image(l.TRAFFIC_CONE,"assets/img/cars/straight_cone.png"),this.load.image(l.BOSS,"assets/img/cars/boss.png"),this.load.spritesheet(l.BUTTON_CONTINUE,"assets/img/button-continue.png",{frameWidth:180,frameHeight:180}),this.load.json("level0","assets/Levels/level_0.json"),this.load.json("level1","assets/Levels/level_1.json"),this.load.json("level2","assets/Levels/level_2.json"),this.load.json("level3","assets/Levels/level_3.json"),this.load.json("sample","assets/Levels/sample.json");for(let e=0;e<120;e++)this.load.json(`auto_level_${e}`,`assets/Levels/AutoGenerated/auto_level_${e}.json`)}create(){const e=this.cache.json.get("level0"),t=this.cache.json.get("level1"),s=this.cache.json.get("level2"),i=this.cache.json.get("level3"),r=this.cache.json.get("sample"),o=O.getInstance();o.addLevel(r),o.addLevel(e),o.addLevel(t),o.addLevel(s);for(let e=0;e<120;e++){const t=this.cache.json.get(`auto_level_${e}`);o.addLevel(t)}o.addLevel(i),o.setLevelIndex(0),this.scene.start("MainScene")}}function he(){const e={backgroundColor:15528177,scale:{autoCenter:Phaser.Scale.CENTER_BOTH,height:720*i.ASPECT_RATIO,mode:Phaser.Scale.FIT,parent:"theGame",width:720},scene:[ce,le]};new Phaser.Game(e),window.focus()}window.onload=he,document.addEventListener("deviceready",he)},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(e){var r=s[e];if(void 0!==r)return r.exports;var o=s[e]={exports:{}};return t[e].call(o.exports,o,o.exports,i),o.exports}i.m=t,e=[],i.O=(t,s,r,o)=>{if(!s){var n=1/0;for(h=0;h<e.length;h++){for(var[s,r,o]=e[h],a=!0,l=0;l<s.length;l++)(!1&o||n>=o)&&Object.keys(i.O).every((e=>i.O[e](s[l])))?s.splice(l--,1):(a=!1,o<n&&(n=o));if(a){e.splice(h--,1);var c=r();void 0!==c&&(t=c)}}return t}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[s,r,o]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var r,o,[n,a,l]=s,c=0;if(n.some((t=>0!==e[t]))){for(r in a)i.o(a,r)&&(i.m[r]=a[r]);if(l)var h=l(i)}for(t&&t(s);c<n.length;c++)o=n[c],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(h)},s=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(57)));var r=i.O(void 0,[216],(()=>i(204)));r=i.O(r)})();