/*! For license information please see main.85fcc8be321bd3ac04cd.bundle.js.LICENSE.txt */
(()=>{var e,t={583:(e,t,s)=>{"use strict";s(260);const i={ASPECT_RATIO:16/9,SWIPE_MAX_TIME:1e3,SWIPE_MIN_DISTANCE:20,DRAG_DISTANCE_THRESHOLD:50,SWIPE_MIN_NORMAL:.85,TILE_SIZE:200,TILE_SPACING:20,TWEEN_SPEED:50},r={length:3,width:2},o={length:4,width:2},a={length:5,width:2};var n;!function(e){e.PHASER_LOGO="phaser-logo",e.EMPTY_TILE="emptytile",e.BUTTON_CONTINUE="button_pause",e.SHORT_0="minicar_blue",e.SHORT_1="minicar_black",e.SHORT_2="minicar_yellow",e.MEDIUM_0="touringcar_dark",e.MEDIUM_1="touringcar_gray",e.MEDIUM_2="touringcar_white",e.LONG_0="pickup_gray",e.LONG_1="pickup_red",e.LONG_2="pickup_white",e.TRAFFIC_CONE="traffic_cone"}(n||(n={}));const c=n;var l;!function(e){e[e.NULL=-1]="NULL",e[e.EMPTY=0]="EMPTY",e[e.SHORT_CAR=1]="SHORT_CAR",e[e.MEDIUM_CAR=2]="MEDIUM_CAR",e[e.LONG_CAR=3]="LONG_CAR",e[e.BLOCKER=4]="BLOCKER"}(l||(l={}));const h=l,g=Phaser.Math.Easing.Sine.InOut;class d{constructor(e){this.car=e,this.scene=this.car.scene}playVerticalMovingAnimation(e,t){const{TILE_SIZE:s,TILE_SPACING:r,TWEEN_SPEED:o}=i;this.car.didExit()&&(t+=this.car.getObjectBoardLength());const a=(s+r)*t,n=this.scene.add.tween({targets:this.car,y:`${e?"+":"-"}=${a}`,duration:o*t,ease:g,onComplete:()=>{this.car.didExit()&&this.playFadeAnimation()}});this.car.setMoveTween(n)}playHorizontalMovingAnimation(e,t){const{TILE_SIZE:s,TILE_SPACING:r,TWEEN_SPEED:o}=i;this.car.didExit()&&(t+=this.car.getObjectBoardLength());const a=(s+r)*t,n=this.scene.add.tween({targets:this.car,x:`${e?"+":"-"}=${a}`,duration:o*t,ease:g,onComplete:()=>{this.car.didExit()&&this.playFadeAnimation()}});this.car.setMoveTween(n)}playFadeAnimation(){this.scene.add.tween({targets:this.car,alpha:0,duration:500,ease:Phaser.Math.Easing.Sine.InOut})}}var u;!function(e){e[e.TILE=0]="TILE",e[e.GAME_OBJECT=1]="GAME_OBJECT"}(u||(u={}));const T=u;var E;!function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT",e[e.UP=2]="UP",e[e.DOWN=3]="DOWN"}(E||(E={}));const m=E;var f;!function(e){e.TRAFFIC_CONE="traffic-cone"}(f||(f={}));const p=f;var b;!function(e){e.SHORT="short-car",e.MEDIUM="medium-car",e.LONG="long-car"}(b||(b={}));const I=b;class C{constructor(){this.levelIndex=0,this.levelConfigs=[]}static getInstance(){return C.instance||(C.instance=new C),C.instance}addLevel(e){this.levelConfigs.push(e)}getLevel(){return this.levelConfigs[this.levelIndex]}getLevelIndex(){return this.levelIndex}setLevelIndex(e){e>=this.levelConfigs.length||(this.levelIndex=e)}increaseLevelIndex(e=1){this.setLevelIndex(this.levelIndex+e)}getMaxLevelIndex(){return this.levelConfigs.length-1}getLevelConfigsLength(){return this.levelConfigs.length}}function O(e,t){const{TILE_SIZE:s,TILE_SPACING:r}=i;let o=r*(t.column+1)+s*(t.column+.5),a=r*(t.row+1)+s*(t.row+.5);const{boardSize:n}=C.getInstance().getLevel();let c=n.rows*s;return c+=(n.rows+1)*r,a+=(e.game.config.height-c)/2,new Phaser.Geom.Point(o,a)}function v(e,t,s,i=!1){let r=[];if(i)for(let i=e.row;i<e.row+s;i++)for(let s=e.column;s<e.column+t;s++){const e={row:i,column:s};r.push(e)}else for(let i=e.row;i<e.row+t;i++)for(let t=e.column;t<e.column+s;t++){const e={row:i,column:t};r.push(e)}return r}function w(e,t,s){const i=[],{boardSize:r}=C.getInstance().getLevel();switch(s){case m.LEFT:for(let s=e.row;s<e.row+t;s++){const e={row:s,column:0};i.push(e)}break;case m.RIGHT:for(let s=e.row;s<e.row+t;s++){const e={row:s,column:r.columns-1};i.push(e)}break;case m.UP:for(let s=e.column;s<e.column+t;s++){const e={row:0,column:s};i.push(e)}break;case m.DOWN:for(let s=e.column;s<e.column+t;s++){const e={row:r.rows-1,column:s};i.push(e)}}return i}function B(e){let t;switch(e){case I.SHORT:t=h.SHORT_CAR;break;case I.MEDIUM:t=h.MEDIUM_CAR;break;case I.LONG:default:t=h.LONG_CAR}return t}function P(e){let t;switch(e){case I.SHORT:t=r;break;case I.MEDIUM:t=o;break;case I.LONG:default:t=a}return t}class k{constructor(e,t=!0){const{boardSize:s}=C.getInstance().getLevel();this.boardArray=[],this.exitTiles=[],this.tileImages=[];for(let i=0;i<s.rows;i++){this.boardArray[i]=[],this.exitTiles[i]=[];for(let r=0;r<s.columns;r++){if(t){const t=O(e,{row:i,column:r});this.tileImages.push(e.add.image(t.x,t.y,c.EMPTY_TILE).setDepth(T.TILE))}this.boardArray[i][r]=h.EMPTY,this.exitTiles[i][r]=!1}}}setTileState(e,t){this.getTileState(e)!=h.NULL&&(this.boardArray[e.row][e.column]=t)}getTileState(e){const{boardSize:t}=C.getInstance().getLevel();return e.row>=0&&e.row<t.rows&&e.column>=0&&e.column<t.columns?this.boardArray[e.row][e.column]:h.NULL}isExit(e){return this.exitTiles[e.row][e.column]}setExit(e){this.exitTiles[e.row][e.column]=!0}printBoard(){console.log(this.boardArray)}clearAllTiles(){this.tileImages.forEach((e=>null==e?void 0:e.destroy())),this.boardArray=[],this.exitTiles=[]}getTileImages(){return this.tileImages}}class M{constructor(e){this.scene=e,this.carConfigs=[],this.blockerConfigs=[],this.generateLevel(M.placeCarOnBorder)}getCarConfigs(){return this.carConfigs}getBlockerConfig(){return this.blockerConfigs}populateCars(e){const{boardSize:t}=C.getInstance().getLevel(),s=[I.SHORT,I.MEDIUM,I.LONG];for(let i=e?0:1;i<t.rows-(e?0:1);i++)for(let r=e?0:1;r<t.columns-(e?0:1);r++){const t={type:s[Phaser.Math.Between(0,s.length-1)],boardPosition:{row:i,column:r},isVertical:1==Phaser.Math.Between(0,1)},o=this.generatePredictableOverlapTiles(t),a=!0;this.canPlaceCarOnTiles(o,e)&&a&&(this.carConfigs.push(t),o.forEach((e=>{this.boardManager.setTileState(e,B(t.type))})),this.markCarExitTiles(t))}}canPlaceCarOnTiles(e,t){const{boardSize:s}=C.getInstance().getLevel();for(const i of e){const e=(t?0:1)<=i.row&&i.row<s.rows-(t?0:1),r=(t?0:1)<=i.column&&i.column<s.columns-(t?0:1),o=e&&r;if(this.boardManager.getTileState(i)!=h.EMPTY||!o)return!1}return!0}markCarExitTiles(e){let t=[],s=[];e.isVertical?(t=w(e.boardPosition,P(e.type).width,m.UP),s=w(e.boardPosition,P(e.type).width,m.DOWN)):(t=w(e.boardPosition,P(e.type).width,m.LEFT),s=w(e.boardPosition,P(e.type).width,m.RIGHT)),t.forEach((e=>{this.boardManager.setExit(e)})),s.forEach((e=>{this.boardManager.setExit(e)}))}populateBlockers(){const e=[p.TRAFFIC_CONE];Phaser.Math.Between(0,e.length-1),p.TRAFFIC_CONE,this.populateTrafficCones()}populateTrafficCones(){this.populateTopEdgeTrafficCone(),this.populateBottomEdgeTrafficCone()}populateTopEdgeTrafficCone(){const{boardSize:e}=C.getInstance().getLevel();for(let t=0;t<e.rows;t++){const s={row:t,column:0},i={row:t,column:e.columns-1};if(!this.boardManager.isExit(s)){const e={type:p.TRAFFIC_CONE,boardPosition:s};1==Phaser.Math.Between(0,1)&&this.blockerConfigs.push(e)}if(!this.boardManager.isExit(i)){const e={type:p.TRAFFIC_CONE,boardPosition:i};1==Phaser.Math.Between(0,1)&&this.blockerConfigs.push(e)}}}populateBottomEdgeTrafficCone(){const{boardSize:e}=C.getInstance().getLevel();for(let t=1;t<e.columns-1;t++){const s={row:0,column:t},i={row:e.rows-1,column:t};if(!this.boardManager.isExit(s)){const e={type:p.TRAFFIC_CONE,boardPosition:s};1==Phaser.Math.Between(0,1)&&this.blockerConfigs.push(e)}if(!this.boardManager.isExit(i)){const e={type:p.TRAFFIC_CONE,boardPosition:i};1==Phaser.Math.Between(0,1)&&this.blockerConfigs.push(e)}}}generatePredictableOverlapTiles(e){const t=P(e.type);return v(e.boardPosition,t.width,t.length,e.isVertical)}generateLevel(e=!1){this.carConfigs=[],this.blockerConfigs=[],this.boardManager=new k(this.scene,!1),this.populateCars(e),e||this.populateBlockers()}}M.placeCarOnBorder=!0;class x{constructor(){this.blockers=[],this.blockersAtExit=[]}static getInstance(){return x.instance||(x.instance=new x),x.instance}push(e,t=!1){this.blockers.push(e),t&&this.blockersAtExit.push(e)}toArray(){return this.blockers}clearAllBlocker(){this.blockers.forEach((e=>null==e?void 0:e.destroy())),this.blockers=[],this.blockersAtExit=[]}deleteBlocker(e){const t=this.blockers.indexOf(e);-1!==t&&this.blockers.splice(t,1),this.blockersAtExit.indexOf(e),-1!==t&&this.blockersAtExit.splice(t,1)}getBlockersAtExit(){return this.blockersAtExit}}class _ extends Phaser.GameObjects.Image{constructor(e,t,s){const i=O(e,t);super(e,i.x,i.y,s),this.setOrigin(.5,.5),this.setDepth(T.GAME_OBJECT),this.boardPosition=t,this.setOverlapTileStates(h.BLOCKER),e.add.existing(this)}setOverlapTileStates(e){const t=this.scene;null==t||t.getBoardManager().setTileState(this.boardPosition,e)}getBoardPosition(){return this.boardPosition}}class L extends _{constructor(e,t,s=c.TRAFFIC_CONE){super(e,t,s)}}class S{constructor(e,t,s,i){this.removeBlockingCorns=e=>{this.mainScene.getBoardManager().getTileState(e)==h.BLOCKER&&x.getInstance().getBlockersAtExit().forEach((t=>{t.getBoardPosition().row==e.row&&t.getBoardPosition().column==e.column&&(t.setOverlapTileStates(h.EMPTY),console.log("destroy "+t.getBoardPosition().row+" "+t.getBoardPosition().column),x.getInstance().deleteBlocker(t),t.destroy())}))},this.mainScene=e,this.firstTiles=t,this.secondTiles=s,this.placeCarOnBorder=i,t.forEach((e=>{this.mainScene.getBoardManager().setExit(e)})),s.forEach((e=>{this.mainScene.getBoardManager().setExit(e)}))}getScene(){return this.mainScene}getFirstTiles(){return this.firstTiles}getSecondTiles(){return this.secondTiles}blockFirstTiles(){this.placeCarOnBorder||this.areFirstTilesBlocked()||this.areSecondTilesBlocked()||this.firstTiles.forEach((e=>{const t=new L(this.mainScene,e);x.getInstance().push(t,!0)}))}blockSecondTiles(){this.placeCarOnBorder||this.areFirstTilesBlocked()||this.areSecondTilesBlocked()||this.secondTiles.forEach((e=>{const t=new L(this.mainScene,e);x.getInstance().push(t,!0)}))}removeBlockerInFirstTiles(){this.firstTiles.forEach(this.removeBlockingCorns)}removeBlockerInSecondTiles(){this.secondTiles.forEach(this.removeBlockingCorns)}areFirstTilesBlocked(){for(const e of this.firstTiles)if(this.mainScene.getBoardManager().getTileState(e)===h.BLOCKER)return!0;return!1}areSecondTilesBlocked(){for(const e of this.secondTiles)if(this.mainScene.getBoardManager().getTileState(e)===h.BLOCKER)return!0;return!1}areAllTilesGroupsBlocked(){return this.areFirstTilesBlocked()&&this.areSecondTilesBlocked()}}class A{constructor(){this.cars=[],this.exitedCarNum=0}static getInstance(){return A.instance||(A.instance=new A),A.instance}push(e){this.cars.push(e)}didAllCarExit(){return this.exitedCarNum==this.cars.length&&this.cars.length>0}toArray(){return this.cars}clearAllCars(){this.cars.forEach((e=>null==e?void 0:e.destroy())),this.cars=[],this.exitedCarNum=0}increaseExitedCarNum(){this.exitedCarNum++}}const N=r,R=N.width,y=N.length,F=h.SHORT_CAR;class G extends Phaser.GameObjects.Image{constructor(e,t,s=!1,r){super(e,0,0,r),this.overlapTiles=[],this.exited=!1,this.handleDragging=(e,t,s)=>{if(!this.moveTween)if(this.isVertical){const e=s-this.y;Math.abs(e)>i.SWIPE_MIN_DISTANCE&&this.moveVertically(e)}else{const e=t-this.x;Math.abs(e)>i.SWIPE_MIN_DISTANCE&&this.moveHorizontally(e)}},this.setOrigin(.5,.5),this.setDepth(T.GAME_OBJECT),e.add.existing(this),this.initAnimator(),this.initRotation(s),this.initBoardPosition(t),this.initExitTiles(),this.setOverlapTilesState(this.getTileState()),this.initInteractive(),Math.random()<.5&&this.setFlipX(!0),Math.random()<.5&&this.setFlipY(!0)}getBoardPosition(){return this.boardPosition}getTileState(){return F}getObjectBoardLength(){return y}getObjectBoardWidth(){return R}isCarVertical(){return this.isVertical}getExitManager(){return this.exitManager}didExit(){return this.exited}setMoveTween(e){this.moveTween=e}initAnimator(){this.animator=new d(this)}initExitTiles(){const e=this.scene;let t=[],s=[];this.isVertical?(t=w(this.boardPosition,this.getObjectBoardWidth(),m.UP),s=w(this.boardPosition,this.getObjectBoardWidth(),m.DOWN)):(t=w(this.boardPosition,this.getObjectBoardWidth(),m.LEFT),s=w(this.boardPosition,this.getObjectBoardWidth(),m.RIGHT)),this.exitManager=new S(e,t,s,M.placeCarOnBorder)}initBoardPosition(e){this.boardPosition=e,this.initActualPosition()}initActualPosition(){const e=this.calculateActualPosition();this.setPosition(e.x,e.y)}calculateActualPosition(){return function(e,t,s,i,r=!1){const o=r?(i-1)/2:s/4,a=r?s/4:(i-1)/2;return O(e,{row:t.row+o,column:t.column+a})}(this.scene,this.boardPosition,this.getObjectBoardWidth(),this.getObjectBoardLength(),this.isVertical)}initRotation(e){this.isVertical=e,this.angle=e?90:0}initInteractive(){this.setInteractive({useHandCursor:!0}),this.scene.input.setDraggable(this),this.on(Phaser.Input.Events.DRAG,this.handleDragging),this.on(Phaser.Input.Events.DRAG_END,(()=>{this.moveTween=void 0}))}canTileBlockCar(e){return e===h.LONG_CAR||e===h.MEDIUM_CAR||e===h.SHORT_CAR||e===h.BLOCKER}moveVertically(e){const t=this.scene,s=e>=0;let i,r;if(s){const e=this.getFrontTiles(),s=e[0].row;let o=s;for(;;){o++;let s=!1,i=!1;for(const r of e){const e={row:o,column:r.column},a=t.getBoardManager().getTileState(e);if(this.canTileBlockCar(a)){s=!0,i=!1;break}i=a===h.NULL}if(s)break;if(i){this.executeExit();break}}i=o-1,r=i-s}else{const e=this.getRearTiles(),s=e[0].row;let o=s;for(;;){o--;let s=!1,i=!1;for(const r of e){const e={row:o,column:r.column},a=t.getBoardManager().getTileState(e);if(this.canTileBlockCar(a)){s=!0,i=!1;break}i=a===h.NULL}if(s)break;if(i){this.executeExit();break}}i=o+1,r=s-i}this.exited&&this.removeInteractive(),this.resetOverlapTilesVertical(s,r),this.animator.playVerticalMovingAnimation(s,r)}resetOverlapTilesVertical(e,t){this.setOverlapTilesState(h.EMPTY),this.exited||(e?this.boardPosition.row+=t:this.boardPosition.row-=t,this.setOverlapTilesState(this.getTileState()))}setOverlapTilesState(e){const t=this.scene;this.getOverlapTiles().forEach((s=>{t.getBoardManager().getTileState({row:s.row,column:s.column})!=h.NULL?t.getBoardManager().setTileState(s,e):console.log(`${s.row} ${s.column} is null`)}))}moveHorizontally(e){const t=this.scene,s=e>=0;let i,r;if(s){const e=this.getFrontTiles(),s=e[0].column;let o=s;for(;;){o++;let s=!1,i=!1;for(const r of e){const e={row:r.row,column:o},a=t.getBoardManager().getTileState(e);if(this.canTileBlockCar(a)){s=!0,i=!1;break}i=a===h.NULL}if(s)break;if(i){this.executeExit();break}}i=o-1,r=i-s}else{const e=this.getRearTiles(),s=e[0].column;let o=s;for(;;){o--;let s=!1,i=!1;for(const r of e){const e={row:r.row,column:o},a=t.getBoardManager().getTileState(e);if(this.canTileBlockCar(a)){s=!0,i=!1;break}i=a===h.NULL}if(s)break;if(i){this.executeExit();break}}i=o+1,r=s-i}this.exited&&this.removeInteractive(),this.resetOverlapTilesHorizontal(s,r),this.animator.playHorizontalMovingAnimation(s,r)}resetOverlapTilesHorizontal(e,t){this.setOverlapTilesState(h.EMPTY),this.exited||(e?this.boardPosition.column+=t:this.boardPosition.column-=t,this.setOverlapTilesState(this.getTileState()))}getRearTiles(){let e=[];if(this.isVertical)for(let t=this.boardPosition.column;t<this.boardPosition.column+this.getObjectBoardWidth();t++){const s={row:this.boardPosition.row,column:t};e.push(s)}else for(let t=this.boardPosition.row;t<this.boardPosition.row+this.getObjectBoardWidth();t++){const s={row:t,column:this.boardPosition.column};e.push(s)}return e}getFrontTiles(){let e=[];if(this.isVertical)for(let t=this.boardPosition.column;t<this.boardPosition.column+this.getObjectBoardWidth();t++){const s={row:this.boardPosition.row+this.getObjectBoardLength()-1,column:t};e.push(s)}else for(let t=this.boardPosition.row;t<this.boardPosition.row+this.getObjectBoardWidth();t++){const s={row:t,column:this.boardPosition.column+this.getObjectBoardLength()-1};e.push(s)}return e}getOverlapTiles(){return this.overlapTiles=v(this.boardPosition,this.getObjectBoardWidth(),this.getObjectBoardLength(),this.isVertical),this.overlapTiles}executeExit(){this.exited=!0,A.getInstance().increaseExitedCarNum()}}class D extends G{constructor(e,t,s=!1,i){let r;switch(Phaser.Math.Between(0,2)){case 0:r=c.SHORT_0;break;case 1:r=c.SHORT_1;break;default:r=c.SHORT_2}super(e,t,s,null==i?r:i)}getObjectBoardWidth(){return r.width}getObjectBoardLength(){return r.length}getTileState(){return h.SHORT_CAR}}class j extends G{constructor(e,t,s=!1,i){let r;switch(Phaser.Math.Between(0,2)){case 0:r=c.LONG_0;break;case 1:r=c.LONG_1;break;default:r=c.LONG_2}super(e,t,s,null==i?r:i)}getObjectBoardWidth(){return a.width}getObjectBoardLength(){return a.length}getTileState(){return h.LONG_CAR}}class U extends G{constructor(e,t,s=!1,i){let r;switch(Phaser.Math.Between(0,2)){case 0:r=c.MEDIUM_0;break;case 1:r=c.MEDIUM_1;break;default:r=c.MEDIUM_2}super(e,t,s,null==i?r:i)}getObjectBoardWidth(){return o.width}getObjectBoardLength(){return o.length}getTileState(){return h.MEDIUM_CAR}}var H;!function(e){e.PRELOAD="PreloadScene",e.MAIN="MainScene"}(H||(H={}));const W=H;class V{constructor(e,t=!1){this.cars=e,t&&this.blockExits}blockExits(){this.cars.forEach((e=>{1==Phaser.Math.Between(0,1)&&(0===Phaser.Math.Between(0,1)?e.getExitManager().blockFirstTiles():e.getExitManager().blockSecondTiles())})),this.cars.forEach((e=>{e.getExitManager().areAllTilesGroupsBlocked()&&e.getExitManager().removeBlockerInFirstTiles()})),this.debugBlockedCars(65280),this.solveTwoBlockedCars()}debugBlockedCars(e){this.cars.forEach((t=>{t.getExitManager().areAllTilesGroupsBlocked()&&t.setTintFill(e)}))}solveTwoBlockedCars(){for(let e=0;e<this.cars.length;e++)if(this.cars[e].isCarVertical()){if(this.cars[e].getExitManager().areFirstTilesBlocked())for(let t=e+1;t<this.cars.length;t++)1==Math.abs(this.cars[t].getBoardPosition().column-this.cars[e].getBoardPosition().column)&&this.cars[t].getExitManager().areSecondTilesBlocked()&&this.cars[t].isCarVertical()&&this.cars[e].getExitManager().removeBlockerInFirstTiles()}else if(this.cars[e].getExitManager().areFirstTilesBlocked())for(let t=e+1;t<this.cars.length;t++)1==Math.abs(this.cars[t].getBoardPosition().row-this.cars[e].getBoardPosition().row)&&this.cars[t].getExitManager().areSecondTilesBlocked()&&!this.cars[t].isCarVertical()&&this.cars[t].getBoardPosition().column>this.cars[e].getBoardPosition().column&&this.cars[e].getExitManager().removeBlockerInFirstTiles();else if(this.cars[e].getExitManager().areSecondTilesBlocked())for(let t=e+1;t<this.cars.length;t++)1==Math.abs(this.cars[t].getBoardPosition().row-this.cars[e].getBoardPosition().row)&&this.cars[t].getExitManager().areFirstTilesBlocked()&&!this.cars[t].isCarVertical()&&this.cars[t].getBoardPosition().column<this.cars[e].getBoardPosition().column&&this.cars[e].getExitManager().removeBlockerInSecondTiles()}}class z extends Phaser.GameObjects.Image{constructor(e,t,s,i,r,o){super(r,e,t,s,0),this.setInteractive({useHandCursor:!0}),this.setScrollFactor(0),this.on(Phaser.Input.Events.POINTER_UP,(()=>{o||this.setFrame(1)}),this),this.on(Phaser.Input.Events.POINTER_DOWN,(()=>{o||this.setFrame(2),i.call(r)}),this),this.on(Phaser.Input.Events.POINTER_OVER,(()=>{o||this.setFrame(1)}),this),this.on(Phaser.Input.Events.POINTER_OUT,(()=>{o||this.setFrame(0)}),this),r.add.existing(this)}}class Y extends z{constructor(e,t,s,i){super(t,s,i,(()=>{C.getInstance().increaseLevelIndex(),e.scene.restart()}),e,!1),this.setOrigin(0,0)}}class K extends Phaser.Scene{constructor(){super(W.MAIN),this.carConfigs=[],this.blockerConfigs=[],this.showedWinPopup=!1}init(){var e;this.carConfigs=[],this.blockerConfigs=[],this.showedWinPopup=!1,null===(e=this.boardManager)||void 0===e||e.clearAllTiles(),A.getInstance().clearAllCars(),x.getInstance().clearAllBlocker()}create(){this.input.dragDistanceThreshold=i.DRAG_DISTANCE_THRESHOLD,this.initCamera(),this.initBoard(),this.initLevelGenerator(),this.initCars(),this.initBlockers(),this.initButtonNextLevel()}initCamera(){const{boardSize:e}=C.getInstance().getLevel(),{TILE_SIZE:t,TILE_SPACING:s}=i,r=t+s;let o=e.columns*r;o+=s,this.cameras.main.setZoom(this.game.config.width/o/1.3).centerOnX(o/2)}initBoard(){this.boardManager=new k(this)}initLevelGenerator(){M.placeCarOnBorder=!0,C.getInstance().getLevelIndex()===C.getInstance().getLevelConfigsLength()-1&&(M.placeCarOnBorder=!1),this.levelGenerator=new M(this)}initCars(){C.getInstance().getLevelIndex()===C.getInstance().getLevelConfigsLength()-1?this.carConfigs=this.levelGenerator.getCarConfigs():this.carConfigs=C.getInstance().getLevel().cars,this.carConfigs.forEach((e=>{A.getInstance().push(this.generateCar(e))}))}initBlockers(){C.getInstance().getLevelIndex()===C.getInstance().getLevelConfigsLength()-1?this.blockerConfigs=this.levelGenerator.getBlockerConfig():this.blockerConfigs=C.getInstance().getLevel().blockers,this.blockerConfigs.forEach((e=>{x.getInstance().push(this.generateBlocker(e))})),this.initExitBlockerSpawner()}initExitBlockerSpawner(){this.exitBlockerSpawner=new V(A.getInstance().toArray()),this.exitBlockerSpawner.blockExits()}initButtonNextLevel(){this.UICamera=this.cameras.add(),this.UICamera.ignore(this.getBoardManager().getTileImages()),this.UICamera.ignore(A.getInstance().toArray()),this.UICamera.ignore(x.getInstance().toArray());const e=new Y(this,20,20,c.BUTTON_CONTINUE).setScale(.5);e.setDepth(10),this.cameras.main.ignore(e)}generateCar(e){let t;switch(e.type){case I.SHORT:t=new D(this,e.boardPosition,e.isVertical,e.texture);break;case I.MEDIUM:t=new U(this,e.boardPosition,e.isVertical,e.texture);break;case I.LONG:default:t=new j(this,e.boardPosition,e.isVertical,e.texture)}return t}generateBlocker(e){let t;return e.type,p.TRAFFIC_CONE,t=new L(this,e.boardPosition,e.texture),t}getBoardManager(){return this.boardManager}update(e,t){var s,i;A.getInstance().didAllCarExit()&&!this.showedWinPopup&&(console.log("WIN"),this.showedWinPopup=!0,s=()=>{C.getInstance().increaseLevelIndex(),this.scene.restart()},(i=this).cameras.main.fadeOut(500),i.time.addEvent({delay:500,callback:function(){i.cameras.main.fadeIn(500),s()},callbackScope:i}))}}class Z extends Phaser.Scene{constructor(){super(W.PRELOAD)}preload(){this.load.image(c.PHASER_LOGO,"assets/img/phaser-logo.png"),this.load.image(c.EMPTY_TILE,"assets/img/emptytile.png"),this.load.image(c.SHORT_0,"assets/img/cars/minicar_blue.png"),this.load.image(c.SHORT_1,"assets/img/cars/minicar_black.png"),this.load.image(c.SHORT_2,"assets/img/cars/minicar_yellow.png"),this.load.image(c.MEDIUM_0,"assets/img/cars/touringcar_dark.png"),this.load.image(c.MEDIUM_1,"assets/img/cars/touringcar_gray.png"),this.load.image(c.MEDIUM_2,"assets/img/cars/touringcar_white.png"),this.load.image(c.LONG_0,"assets/img/cars/pickup_gray.png"),this.load.image(c.LONG_1,"assets/img/cars/pickup_red.png"),this.load.image(c.LONG_2,"assets/img/cars/pickup_white.png"),this.load.image(c.TRAFFIC_CONE,"assets/img/cars/straight_cone.png"),this.load.spritesheet(c.BUTTON_CONTINUE,"assets/img/button-continue.png",{frameWidth:180,frameHeight:180}),this.load.json("level0","assets/Levels/level_0.json"),this.load.json("level1","assets/Levels/level_1.json"),this.load.json("level2","assets/Levels/level_2.json"),this.load.json("level3","assets/Levels/level_3.json")}create(){const e=this.cache.json.get("level0"),t=this.cache.json.get("level1"),s=this.cache.json.get("level2"),i=this.cache.json.get("level3");C.getInstance().addLevel(e),C.getInstance().addLevel(t),C.getInstance().addLevel(s),C.getInstance().addLevel(i),C.getInstance().setLevelIndex(0),this.scene.start("MainScene")}}function $(){const e={backgroundColor:15528177,scale:{autoCenter:Phaser.Scale.CENTER_BOTH,height:720*i.ASPECT_RATIO,mode:Phaser.Scale.FIT,parent:"theGame",width:720},scene:[Z,K]};new Phaser.Game(e),window.focus()}window.onload=$,document.addEventListener("deviceready",$)},204:()=>{console.log("%c %c %c %c %c Built using phaser-project-template %c https://github.com/yandeu/phaser-project-template","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none")}},s={};function i(e){var r=s[e];if(void 0!==r)return r.exports;var o=s[e]={exports:{}};return t[e].call(o.exports,o,o.exports,i),o.exports}i.m=t,e=[],i.O=(t,s,r,o)=>{if(!s){var a=1/0;for(h=0;h<e.length;h++){for(var[s,r,o]=e[h],n=!0,c=0;c<s.length;c++)(!1&o||a>=o)&&Object.keys(i.O).every((e=>i.O[e](s[c])))?s.splice(c--,1):(n=!1,o<a&&(a=o));if(n){e.splice(h--,1);var l=r();void 0!==l&&(t=l)}}return t}o=o||0;for(var h=e.length;h>0&&e[h-1][2]>o;h--)e[h]=e[h-1];e[h]=[s,r,o]},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={179:0};i.O.j=t=>0===e[t];var t=(t,s)=>{var r,o,[a,n,c]=s,l=0;if(a.some((t=>0!==e[t]))){for(r in n)i.o(n,r)&&(i.m[r]=n[r]);if(c)var h=c(i)}for(t&&t(s);l<a.length;l++)o=a[l],i.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return i.O(h)},s=self.webpackChunkphaser_project_template=self.webpackChunkphaser_project_template||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),i.O(void 0,[216],(()=>i(583)));var r=i.O(void 0,[216],(()=>i(204)));r=i.O(r)})();